name: CI/CD Pipeline for TodoList App

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  # Job 1: Basic validation and testing
  validate:
    name: Validate Application
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout code
      uses: actions/checkout@v4
      
    - name: 🔍 Validate project structure
      run: |
        echo "Checking project structure..."
        ls -la
        echo "--- Essential Files Check ---"
        [ -f "index.html" ] && echo "✅ index.html - OK" || echo "❌ index.html - MISSING"
        [ -f "style.css" ] && echo "✅ style.css - OK" || echo "❌ style.css - MISSING" 
        [ -f "script.js" ] && echo "✅ script.js - OK" || echo "❌ script.js - MISSING"
        [ -f "server.js" ] && echo "✅ server.js - OK" || echo "❌ server.js - MISSING"
        [ -f "package.json" ] && echo "✅ package.json - OK" || echo "❌ package.json - MISSING"
        [ -f "Dockerfile" ] && echo "✅ Dockerfile - OK" || echo "❌ Dockerfile - MISSING"
        [ -f "test.js" ] && echo "✅ test.js - OK" || echo "❌ test.js - MISSING"
        
    - name: 🧪 Run basic tests
      run: |
        echo "Running basic application tests..."
        node test.js

  # Job 2: Docker build (simplified)
  docker-build:
    name: Build Docker Image
    runs-on: ubuntu-latest
    needs: validate
    
    steps:
    - name: 📥 Checkout code
      uses: actions/checkout@v4
      
    - name: 🐳 Set up Docker Buildx
      uses: docker/setup-buildx-action@v3
      
    - name: 🔨 Build Docker image
      run: |
        echo "Building Docker image..."
        docker build -t todolist-app .
        echo "✅ Docker image built successfully!"
        
    - name: 📋 Show build info
      run: |
        echo "Docker build completed!"
        echo "Image: todolist-app"
        echo "To run locally: docker run -p 3000:3000 todolist-app"

  # Job 3: Final success
  success:
    name: 🎉 Pipeline Successful
    runs-on: ubuntu-latest
    needs: [validate, docker-build]
    
    steps:
    - name: ✅ All checks passed
      run: |
        echo "🎉 CI/CD Pipeline Completed Successfully!"
        echo "✅ Code validation passed"
        echo "✅ Docker build successful" 
        echo "✅ Application ready for deployment"
        echo ""
        echo "📝 Next: Add container registry push for production"