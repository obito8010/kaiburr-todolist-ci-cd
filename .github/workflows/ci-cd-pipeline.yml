name: CI/CD Pipeline for TodoList App

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  # Job 1: Basic validation and testing
  validate:
    name: Validate Application
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ” Validate project structure
      run: |
        echo "Checking project structure..."
        ls -la
        echo "--- Essential Files Check ---"
        [ -f "index.html" ] && echo "âœ… index.html - OK" || echo "âŒ index.html - MISSING"
        [ -f "style.css" ] && echo "âœ… style.css - OK" || echo "âŒ style.css - MISSING" 
        [ -f "script.js" ] && echo "âœ… script.js - OK" || echo "âŒ script.js - MISSING"
        [ -f "server.js" ] && echo "âœ… server.js - OK" || echo "âŒ server.js - MISSING"
        [ -f "package.json" ] && echo "âœ… package.json - OK" || echo "âŒ package.json - MISSING"
        [ -f "Dockerfile" ] && echo "âœ… Dockerfile - OK" || echo "âŒ Dockerfile - MISSING"
        [ -f "test.js" ] && echo "âœ… test.js - OK" || echo "âŒ test.js - MISSING"
        
    - name: ğŸ§ª Run basic tests
      run: |
        echo "Running basic application tests..."
        node test.js

  # Job 2: Docker build (simplified)
  docker-build:
    name: Build Docker Image
    runs-on: ubuntu-latest
    needs: validate
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ³ Set up Docker Buildx
      uses: docker/setup-buildx-action@v3
      
    - name: ğŸ”¨ Build Docker image
      run: |
        echo "Building Docker image..."
        docker build -t todolist-app .
        echo "âœ… Docker image built successfully!"
        
    - name: ğŸ“‹ Show build info
      run: |
        echo "Docker build completed!"
        echo "Image: todolist-app"
        echo "To run locally: docker run -p 3000:3000 todolist-app"

  # Job 3: Final success
  success:
    name: ğŸ‰ Pipeline Successful
    runs-on: ubuntu-latest
    needs: [validate, docker-build]
    
    steps:
    - name: âœ… All checks passed
      run: |
        echo "ğŸ‰ CI/CD Pipeline Completed Successfully!"
        echo "âœ… Code validation passed"
        echo "âœ… Docker build successful" 
        echo "âœ… Application ready for deployment"
        echo ""
        echo "ğŸ“ Next: Add container registry push for production"